# 000. Explanation of approach

## Date: 26 Sep 2023

## Status: Accepted

## Context:

A form structure is read from the DB as a potentially large JSON data with manny
possible nested elements.

- We have different element types. `Forms::Elements::Layouts::` (Layout
  Elements) and `Forms::Elements::Inputs::*` (Input Elements).
- `Forms::Elements::Inputs::*` are nested within `Forms::Elements::Layouts::`
- `Forms::Elements::Layouts::` can be nested within`Forms::Elements::Layouts::`.

When saving a form, we need to completely ignore the structure and `POST` a flat
structure of `element_id: value`

### `formStateSlice`

To generate this `POST` structure, the `Forms::Elements` is recursively iterated
over, extracting out all `element_id`s from all `form_elements` of type
`Forms::Elements::Inputs::*`, until the max depth has been reached.

### `menuStateSlice`

- A multi-page form will have a `Forms::Elements::Layouts::Menu` menu.
- A Menu is a Layout Element that contains a list of either
  `Forms::Elements::Layouts::MenuGroup` or `Forms::Elements::Layouts::MenuItem`.
- A `Forms::Elements::Layouts::MenuGroup` has a list of
  `Forms::Elements::Layouts::MenuItem`.
- Each `Forms::Elements::Layouts::MenuItem` then contains
  `Forms::Elements::Inputs::*`.
- A requirement from design is that this `Forms::Elements::Layouts::Menu` is
  presented in a Drawer, that can be expanded / shut and can be navigated
  through each section either by footer actions or by clicking the
  `Forms::Elements::Layouts::MenuItem` in the drawer.

### `conditional rendering`

Further complications arise where we have conditional rendering within a
`Forms::Elements::Layouts::` or an `Forms::Elements::Inputs::*`. If the
condition evaluates as true, we display the Element.

### `validationSlice`

Further, further complications arise in that there is a requirement to display
any input / validation errors on both an input element level and the parent
`Forms::Elements::Layouts::MenuItem` level.

Which led to creation of the `validationSlice`.

```
{ [element_id: string]: {
    status: PENDING | VALID | INVALID,
    message: null
  }
}
```

- if a `Forms::Elements::Inputs::*` is optional, the status is immediately set
  to `VALID`
- if a `Forms::Elements::Inputs::*` is not optional, the status is immediately
  set to `PENDING`
- if the user interacts with a non-optional field and the input does not satisfy
  the requirements, the status is set to `INVALID`

Selectors aree used to fetch the element_ids for a
`Forms::Elements::Layouts::Menu`, `Forms::Elements::Layouts::MenuGroup` or
`Forms::Elements::Layouts::MenuItem` and retrieve the validation state for those
keys, to determine if the target section is `VALID`, `PENDING` or `INVALID`.

Further requirements are such that some optioanl fields become mandatory only
when a condition of another field is satisfied. A new property has been added to
the `Forms::Elements::Inputs::*` config, called `validation` which has the same
structure as a `condition`.

### `form generation`

Finally, once the relative state above has been created, a new component,
`CommonInputElement` is created, using the render props pattern that will manage
the `children`'s

- `input`
- `validation`
- `update`
- `error handling`

## Consequences:

The primary focus here is to support League Ops Registration form. A number of
leagues are onboarding from December / January and this form needs to be
dynamic.
