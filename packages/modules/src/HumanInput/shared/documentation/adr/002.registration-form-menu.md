# 002. Structure of Registration Form Menu

## Date: 18 Sep 2023

## Status: Accepted

## Context:

As part of League Operations, a Registration form was required. This was built
specifically for MLS Next 23/24 Season, due to time constraints.

Now that this feature has been delivered, there is a need to roll out
registration forms for the following scenarios:

- MLS Next 24/25 Season
- MLS Next Pro 24/25 Season
- Premier League 24/25 Season

As the current solution is not scalable and not in anyway maintainable, a
dynamic form parser is required.

Form specifications:
https://github.com/KitmanLabs/projects/blob/master/engineering/mobile/Features/Forms/JSON%20specification.md

Due to the complex nature of forms, a menu may be present.

A `Form::Elements::Layouts::Menu` consists of one or more
`Form::Elements::Layouts::MenuGroup` and a MenuGroup consists of one or more
`Form::Elements::Layouts::MenuItem`.

For MLS Next, this menu was hardcoded in the front end.

## Approach

To manage, specifically, form menu state, RTK is proposed and a nested menu
structure will be created.

A form structure is fetched via an API using an RTK Query.

The result of this query is then passed to a slice action
`formMenuSlice/onBuildFormMenu`, to build the menu from a nested collection of
`Form::Elements::` as such

```
{
  id: number,
  element_type: 'Forms::Elements::Layouts::Section',
  config: { },
  form_elements: [{
    id: number,
    element_type: 'Forms::Elements::Layouts::Menu',
    config: { },
    visible: true,
    order: 1,
    form_elements: [{
      id: number,
      element_type: 'Forms::Elements::Layouts::MenuGroup',
      config: {},
      form_elements: [{
        id: number,
        element_type: 'Forms::Elements::Layouts::MenuItem',
        config: {},
        form_elements: [{ .... }]
      }]
    }]
  }],
}
```

to convert it into an object (`FormMenuItem`) in state as such:

```
  menu: [
    {
      key: string,
      index: number,
      title: string,
      element_type: Forms::Elements::Layouts::*,
      items: Array<FormMenuItem/>,
      fields: []
    }
  ]
```

```
key: form_element.config.element_id,
index: Is used to track the active section,
title: form_element.config.text,
element_type: form_element.element_type,
items: Array<FormMenuItem/>,
fields: A list of all the element_id's within this FormElement,
```

A recursive function iterates over the `Array` of `FormElements`, and parsing
elements as such:

- `Forms::Elements::Layouts::Section`: recursively call the function on its
  chidren `form_elements` to parse a
- `Forms::Elements::Layouts::Menu`: recursively call the function on its chidren
  `form_elements` to parse a
- `Forms::Elements::Layouts::MenuGroup`: recursively call the function on its
  chidren `form_elements` to parse a
- `Forms::Elements::Layouts::MenuItem`: we stop at this level
- All elements of type `Forms::Elements::Inputs::*` are ignored

## Decision:

This has been spiked and will be adopted as part of League Ops

## Consequences:

- BE work will be required to create the new API to fetch a form structure by id
- Extensive FE work will be required to make Registration more dynamic and
  generic
- A lot of the utility functions should be extensible to other areas where form
  parsing is required
