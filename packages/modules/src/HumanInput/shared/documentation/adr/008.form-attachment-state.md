# 008. Structure of Form Attachment State

## Date: 29 Sep 2023

## Status: Accepted

## Context:

League Ops registration form state is built using Redux. Redux does not like
non-serialisable values being store.

In addition, our upload pattern is as follows:

- User selects a file
- User makes an intent to upload the selected attachment
- Kitman API will accept the attachment and instantly uplaod it to AWS
- Once uploaded, an `id` is returned. This `id` is the created resource
- The `id` is then saved, along with other form data, as the value for an
  attachment

Keeping these in mind, a separate `formAtatchmentSlice` was created with the
following structure:

```
[id: number]: {
  state: 'IDLE' | 'PENDING' | 'FAILURE' | 'SUCCESS',
  file: AttachedFile,
  message: ?string
}
```

again, utilising the `form_element.id`` as a key.

To manage the above flow, a separate `useUploadAttachment` hook was created whic
wil manage:

- file selection
- attachment queue management
- attachment upload
- form state updates upon success

## Decision:

This has been spiked and will be adopted as part of League Ops

## Consequences:

Existing APIs and infrastructure can be used to deliver this
